create database LIBRARY
go

use LIBRARY

CREATE TABLE [PERSONAS](
	[ID] INT NOT NULL IDENTITY(1,1),
	[CEDULA] BIGINT NOT NULL UNIQUE,--"UNIQUE" EVITA LA REPETICION DE VALORES TRANFORMANDOLOS EN "NULL"
	[NOMBRE_COMPLETO] VARCHAR(80),
	[CELULAR] BIGINT,
	[FIJO] BIGINT,
	CONSTRAINT [PK_PERSONAS] PRIMARY KEY CLUSTERED ([ID])
	/*
	"CONSTRAINT" Especificar reglas para los datos de una tabla.
	CONSTRAINTIndica la restrinccion a.. [PK_PERSONAS]
	Tipo de datoPRIMARY KEY 
	CLUSTEREDAgrupa la restrinccion al..([ID])
	*/
);

CREATE TABLE [AUTORES](
	[CODIGO_AUTOR] INT NOT NULL UNIQUE,
	[SEUDONIMO] VARCHAR(40),
	PAIS_ORIGEN VARCHAR(50),
	CONSTRAINT [PK_AUTORES] PRIMARY KEY CLUSTERED ([CODIGO_AUTOR])
);

CREATE TABLE [USUARIOS](
	[CODIGO_USUARIO] INT NOT NULL UNIQUE,
	[ESTADO] BIT NOT NULL,
	CONSTRAINT [PK_USUARIOS] PRIMARY KEY CLUSTERED ([CODIGO_USUARIO]),
);

CREATE TABLE [CATEGORIAS](
	[ID] INT NOT NULL IDENTITY (1, 1),
	[NOMBRE] VARCHAR(40),
	[DESCRIPCION] VARCHAR(50),
	CONSTRAINT [PK_CATEGORIAS] PRIMARY KEY CLUSTERED ([ID]),
);


CREATE TABLE [LIBROS](
	[ID] INT NOT NULL IDENTITY(1,1),
	[COD_LIBRO] INT NOT NULL UNIQUE,
	[TITULO] VARCHAR(30) NOT NULL,
	[AÑO_PUBLICACION] SMALLDATETIME,
	[ESTADO] BIT NOT NULL,
	[CANT_COPIAS] INT,
	[CATEGORIA] INT NOT NULL,
	CONSTRAINT [PK_LIBROS] PRIMARY KEY CLUSTERED ([ID]),
	CONSTRAINT [FK_LIBROS_CATEGORIAS] FOREIGN KEY ([CATEGORIA]) REFERENCES [CATEGORIAS] ([ID]) ON DELETE NO ACTION ON UPDATE NO ACTION
);

CREATE TABLE [LIBRO_AUTOR](
	[LIBRO] INT NOT NULL,
	[AUTOR] INT NOT NULL,
	CONSTRAINT [FK_AUTORES_LIBROS] FOREIGN KEY ([LIBRO]) REFERENCES [LIBROS] ([ID]) ON DELETE NO ACTION ON UPDATE NO ACTION,
	CONSTRAINT [FK_LIBROS_AUTORES] FOREIGN KEY ([AUTOR]) REFERENCES [AUTORES] ([CODIGO_AUTOR]) ON DELETE NO ACTION ON UPDATE NO ACTION
);

CREATE TABLE [COPIAS]
(
	[ID] INT NOT NULL IDENTITY (1, 1),
	[NOTAS_ESTADO] VARCHAR(55),
	[LIBRO] int NOT NULL,
	CONSTRAINT [PK_COPIAS] PRIMARY KEY CLUSTERED ([ID]),
	CONSTRAINT [FK_COPIAS_LIBROS] FOREIGN KEY ([LIBRO]) REFERENCES [LIBROS] ([ID]) ON DELETE NO ACTION ON UPDATE NO ACTION
)
GO

CREATE TABLE [PRESTAMOS]
(
	[ID] INT NOT NULL IDENTITY (1, 1),
	[FECHA_INICIO] SMALLDATETIME,
	[USUARIO] INT NOT NULL,
	CONSTRAINT [PK_PRESTAMOS] PRIMARY KEY CLUSTERED ([ID]),
	CONSTRAINT [FK_PRESTAMOS_USUARIOS] FOREIGN KEY ([USUARIO]) REFERENCES [USUARIOS] ([CODIGO_USUARIO]) ON DELETE NO ACTION ON UPDATE NO ACTION
)

CREATE TABLE [DETALLES]
(
	[ID] INT NOT NULL IDENTITY (1, 1),
	[FECHA_FINAL] SMALLDATETIME,
	[PRESTAMO] INT NOT NULL,
	[COPIA] INT NOT NULL,
	CONSTRAINT [PK_DETALLES] PRIMARY KEY CLUSTERED ([ID]),
	CONSTRAINT [FK_DETALLES_PRESTAMOS] FOREIGN KEY ([PRESTAMO]) REFERENCES [PRESTAMOS] ([ID]) ON DELETE NO ACTION ON UPDATE NO ACTION,
	CONSTRAINT [FK_DETALLES_COPIAS] FOREIGN KEY ([COPIA]) REFERENCES [COPIAS] ([ID]) ON DELETE NO ACTION ON UPDATE NO ACTION
)

INSERT INTO [PERSONAS]([CEDULA],[NOMBRE],[CELULAR],[FIJO])VALUES
(15123,'Esteban Quintero Yepes',3123448794,5388090),
(51232,'Juan Esteban Zapata Yepes',53243546,43745346),
(23433,'Esteban David Quintero Puerta',23435465,2343465537),
(65413,'Esteban Emanuel Quintero Yepes',68563987,954230635),
(76454,'Angie Esteban Quintero',3123448794,5388090)
SELECT * FROM [PERSONAS]

INSERT INTO [AUTORES]([CODIGO_AUTOR],[SEUDONIMO],PAIS_ORIGEN)VALUES
(65427,'Silleban','Medellín'),
(9876,'Nevereban','Bogota'),
(098756,'Noseban','Bello'),
(98765,'Guerrilleban','Cali'),
(876502,'Mariguneban','Popayan')
SELECT * FROM [AUTORES]

INSERT INTO [USUARIOS]([CODIGO_USUARIO])VALUES
(235765,1),
(763464,0),
(76325436,0),
(7632423,1),
(6436756,1)
SELECT * FROM [USUARIOS]

INSERT INTO [CATEGORIAS] ([NOMBRE],[DESCRIPCION]) VALUES
('Terror','Mucho Terror'),
('Accion','Mucho Accion'),
('Comedia','Mucho Comedia'),
('Suspenso','Mucho Suspenso'),
('Drama','Mucho Drama')
SELECT * FROM [CATEGORIAS]

INSERT INTO [LIBROS]([COD_LIBRO],[TITULO],[AÑO_PUBLICACION],[ESTADO],[CANT_COPIAS],[CATEGORIA]) VALUES
(001,'Titulo1',GETDATE(),1,2423,1),
(002,'Titulo2',GETDATE(),0,13432,2),
(003,'Titulo3',GETDATE(),1,5423,3),
(004,'Titulo4',GETDATE(),0,62534,4),
(005,'Titulo5',GETDATE(),1,9786,5),
(006,'Titulo6',GETDATE(),1,765432,5)
SELECT * FROM [LIBROS]

INSERT INTO [LIBRO_AUTOR]([LIBRO],[AUTOR])VALUES
(001,876502),
(002,098756),
(003,9876),
(004,65427),
(005,98765),
(005,9876)
SELECT * FROM [LIBRO_AUTOR]

INSERT INTO [COPIAS]([NOTAS_ESTADO],[LIBRO])VALUES
('A',002),
('T',002),
('H',005),
('J',003),
('K',004),
('C',001)
SELECT * FROM [COPIAS]


INSERT INTO [PRESTAMOS]([FECHA_INICIO],[USUARIO])VALUES
(GETDATE(),235765),
(GETDATE(),7632423),
(GETDATE(),76325436),
(GETDATE(),6436756),
(GETDATE(),6436756),
(GETDATE(),76325436)
SELECT * FROM [PRESTAMOS]

INSERT INTO [DETALLES]([FECHA_FINAL],[PRESTAMO],[COPIA])VALUES
(GETDATE(),2,3),
(GETDATE(),3,4),
(GETDATE(),4,5),
(GETDATE(),5,6),
(GETDATE(),6,6),
(GETDATE(),7,7)
SELECT * FROM [DETALLES]